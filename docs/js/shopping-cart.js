const backendUrl="https://api.accbuddy.com/public";let product,customer,cart=getShoppingCart();const token=getAccessToken();cart&&(product=fetchProductById(cart.itemID));let checked,qty=1,total=0;function getShoppingCart(){var e=localStorage.getItem("cart");if(e)return JSON.parse(e)}function removeShoppingCart(){localStorage.removeItem("cart")}function getAccessToken(){var e=localStorage.getItem("AuthenticationResult");if(e)return JSON.parse(e).AccessToken}async function fetchProductById(e){e={fetchProductByID:{productID:e}};return fetch(backendUrl,{method:"POST",body:JSON.stringify(e)}).then(e=>e.json()).then(e=>e.result)}async function fetchCustomerByAccessToken(e){var t=new Headers;return t.set("Authorization",e),fetch(backendUrl,{method:"POST",headers:t,body:JSON.stringify({fetchCustomer:!0})}).then(e=>e.json()).then(e=>e.result)}function generateUUID(){let n=(new Date).getTime(),o="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random();return 0<n?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"===e?t:3&t|8).toString(16)})}function sleep(t){return new Promise(e=>setTimeout(e,t))}async function openPopup(){disableppButon(),removeShoppingCart(),disableInputs(),product=await product,customer=await customer;var e={ppCreateOrder:{intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:total.toString()}}]},shoppingCartData:{quantity:qty.toString(),itemID:cart.itemID.replace("productID-",""),discount:customer?.customerDiscount?.toString()||"0",customerID:customer?.PK||"guest-"+generateUUID()}},t=new Headers,t=(t.set("Authorization",token),await fetch(backendUrl,{method:"POST",headers:t,body:JSON.stringify(e)}).then(e=>e.json()).then(e=>e.response));window.location.href=t}function disableppButon(){var e=document.getElementById("pp-button"),t=(e.classList.add("inactive"),e.innerHTML);return e.innerHTML="Processing...",t}function enableppButon(e){var t=document.getElementById("pp-button");t.classList.remove("inactive"),t.innerHTML=e}function showButton(t){console.log("clicked"),document.getElementsByName("checkbox").forEach(function(e){e.id!==t?e.checked=!1:(checked=e.checked)&&undoHighlight()});var e=document.getElementById("pp-button"),n=document.getElementById("buy-button");"abPayment1"===t&&checked?(n.style.display="none",e.style.display="flex"):(e.style.display="none",n.style.display="flex")}async function calculateTotal(){var e=document.getElementById("quantity-input"),t=(await product)["productPrice"],n=document.querySelector(".ab-order-price"),n=(n&&(n.innerHTML="$"+t),(await customer)?.customerDiscount||0),o=document.querySelector(".ab-discount-title + .ab-order-price"),o=(o&&(o.innerHTML="-$"+t*parseInt(e.value)*n/100),qty=parseInt(e.value),total=t*parseInt(e.value)*(1-n/100),document.querySelector(".ab-due-title + .ab-order-price")),t=(o&&(o.innerHTML="$"+total),20<total?document.getElementById("checkbox-container").classList.add("warning-payment"):document.getElementById("checkbox-container").classList.remove("warning-payment"),(await product).productQty);qty>t?(document.getElementById("quantity-container").classList.add("warning-qty"),document.getElementById("quantity-warning").innerHTML=`only ${t} are available`,document.getElementById("quantity-input").classList.add("ab-quantity-warning")):(document.getElementById("quantity-container").classList.remove("warning-qty"),document.getElementById("quantity-input").classList.remove("ab-quantity-warning"))}function showAccountLinkSidebarAndAuthButton(){var t=document.querySelectorAll(".ab-main--sidebar-content ul.account-info-items");for(let e=0;e<t.length;e++)t[e].style.display="block";document.getElementById("auth-button").style.display="flex"}function highlightInputs(){var e=document.getElementById("all-checkbox-container");document.getElementById("no-merchant-selected").classList.remove("hidden"),e.classList.add("highlight")}function undoHighlight(){var e=document.getElementById("all-checkbox-container");document.getElementById("no-merchant-selected").classList.add("hidden"),e.classList.remove("highlight")}function buy(){console.log(checked),checked||(console.log("not checked"),highlightInputs())}function disableInputs(){document.getElementById("abPayment1").disabled=!0,document.getElementById("abPayment2").disabled=!0}token&&(customer=fetchCustomerByAccessToken(token)),document.addEventListener("DOMContentLoaded",async function(){cart||(document.getElementById("loading-screen-message").innerText="shopping cart is empty",document.querySelector(".ab-order-title.ab-violate-color").innerHTML="Shopping card is empty");var{productDescr:e,productImageUrl:t,productName:n,productImageText:o,productQty:c,productWarning:r}=await product,a=(token&&showAccountLinkSidebarAndAuthButton(),document.querySelector(".ab-order-account-icons")),t=(a&&(a.src=t,a.alt=o),document.querySelector(".ab-order-info-title.ab-violate-color")),a=(t&&(t.innerHTML=n),document.querySelector(".ab-order-info-desc")),o=(a&&(a.innerHTML=e),document.querySelector(".ab-available-quantity span")),t=(o&&(o.innerHTML=c),document.querySelector(".ab-note-desc")),n=(t&&(t.innerHTML=r),await calculateTotal(),document.querySelector(".ab-preloader-screen"));n&&n.parentNode.removeChild(n)});