document.addEventListener("DOMContentLoaded",function(){console.log("signin js loaded");const l=document.querySelector("#signin-form");class e{constructor({id:e="",doc:t=document,name:n,validation:s="",validateOnEmptyOnly:i=!1}){this.element=t.querySelector("#"+e),this.parent=this.element.parentElement,this.error=this.parent.querySelector(".alart-text"),this.validation=s,this.name=n,this.validateOnEmptyOnly=i,this.element.addEventListener("focus",()=>this.cleanError()),this.element.addEventListener("blur",()=>this.handleInput())}get isValid(){return!1===this.validateOnEmptyOnly?(console.log("here"),this.validation.test(this.element.value)):this.validateOnEmptyOnly&&0===this.element.value.length?(console.log("here1"),this.validation.test(this.element.value)):(console.log("here2"),!0)}handleInput(){!1===this.isValid?(this.parent.classList.add("warning"),this.error.style.display="flex"):(e.HAS_SUBMITTED&&e.ALL_VALID&&(d.disabled=!1),this.cleanError())}cleanError(){this.parent.classList.remove("warning"),this.error.style.display="none"}}const o={email:new e({id:"signin-email",name:"email",validation:/^[^\s@]+@[^\s@]+\.[^\s@]+$/}),password:new e({id:"signin-password",name:"password",validateOnEmptyOnly:!0,validation:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*#?&])[a-zA-Z\d@$!%*#?&]{8,}$/})},i=Object.keys(o),d=l.querySelector("#signin-submit");var a=!(d.onclick=function(e){e.preventDefault();let t=d.disabled=!0;if(!1===a){a=!0;for(var n of i)o[n].element.addEventListener("input",()=>{!0===d.disabled&&(d.disabled=!function(){var e=!0;for(var t of i)if(!1===o[t].isValid){e=!1;break}return e}())})}var s;for(s of Object.keys(o)){const i=o[s];i.handleInput(),1==t&&!1===i.isValid&&(t=!1)}!1!==t&&grecaptcha.execute()});window.handleSubmit=async function(s){let i=o.email.element.value;d.disabled=!0,d.innerHTML="Signing in";var e=await async function(e){var t={message:"",errorMessage:null,status:null},e=await fetch("https://api.accbuddy.com/public",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signin:{token:e,user:{username:o.email.element.value,password:o.password.element.value}}})}),n=await e.json();if(e.ok||400!=e.status){if(e.ok){const e=n.result;t.message=e,l.reset()}}else{console.log("json response",n);const l=n.error;t.status=e.status,t.errorMessage=l}return console.log("normalized result",t),t}(s);d.innerHTML="Sign in";let t=document.querySelector("#plank-error-id"),n=l.querySelector(".ab-input-group-content-box"),a=l.querySelector(".ab-auth-content-wrap-box"),r=t.querySelector(".plank");if(console.log("result",e),null!==e.errorMessage){t.classList.remove("hidden");const s=t.querySelector("#plank-close");if("NotAuthorizedException"===e.errorMessage)r.innerText="Incorrect password.";else if("UserNotConfirmedException"===e.errorMessage){t.classList.add("hidden"),n.style.display="none",a.style.display="flex";const s=l.querySelector("#resend-email-btn");s.addEventListener("click",async()=>{const e=l.querySelector("#resend-email-btn-inactive"),t=(s.style.display="none",e.style.display="block",l.querySelector("#resend-timer")),n=await async function(e){var t={message:"",errorMessage:null,status:null},e=await fetch("https://api.accbuddy.com/public",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resendConfirmation:{token:"",user:{username:e}}})}),n=await e.json();if(e.ok||400!=e.status){if(e.ok){const e=n.result;t.message=e,l.reset()}}else{console.log("json response",n);const l=n.error;t.status=e.status,t.errorMessage=l}return console.log("resend result",t),t}(i);if(null===n.errorMessage){const i=setInterval(()=>{t?(t.innerText=parseInt(t.innerText)-1,"0"===t.innerText&&(clearInterval(i),t.innerText="59",s.style.display="block",e.style.display="none")):console.log("resendTimer does not exist")},1e3);l.querySelector("#resend-ok").addEventListener("click",()=>{clearInterval(i),t.innerText="59",window.location.assign(window.location.href.replace("signin.html","index.html"))})}else{const e=l.querySelector("#resend-email-btn-inactive");s.style.display="none",e.style.display="block",e.innerText="Resend limit exceeded"}}),l.querySelector("#resend-ok").addEventListener("click",()=>{window.location.assign(window.location.href.replace("signin.html","index.html"))}),d.disabled=!1}s.addEventListener("click",()=>{t.classList.add("hidden")}),d.disabled=!0}else window.location.assign(window.location.href.replace("signin.html","index.html"));grecaptcha.reset()},(t=document.createElement("div")).innerHTML="<div class='g-recaptcha' data-sitekey='6LcShYkmAAAAAA_FN5w0Oewh_-7XzIocjZlX6apw'data-callback='handleSubmit' data-size='invisible'></div>",t=t.firstElementChild,l.appendChild(t),(t=document.createElement("script")).src="https://www.google.com/recaptcha/api.js",t.async=!0,t.defer=!0,document.head.appendChild(t);{var t=document.querySelectorAll(".toggle-eye");let n=!1;t.forEach(e=>{const t=e.parentElement.parentElement.querySelector('input[type="password"]');e.addEventListener("click",()=>{n=!n,t.type=n?"text":"password"})})}});