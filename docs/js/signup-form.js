document.addEventListener("DOMContentLoaded",function(){console.log("signup js loaded");const a=document.querySelector("#signup-form");class e{constructor({id:e="",doc:t=document,name:n,validation:s=""}){this.element=t.querySelector("#"+e),this.parent=this.element.parentElement,this.error=this.parent.querySelector(".alart-text"),this.validation=s,this.name=n,this.element.addEventListener("focus",()=>this.cleanError()),this.element.addEventListener("blur",()=>this.handleInput())}get isValid(){return this.validation.test(this.element.value)}handleInput(){!1===this.isValid?(this.parent.classList.add("warning"),this.error.style.display="flex"):(e.HAS_SUBMITTED&&e.ALL_VALID&&(l.disabled=!1),this.cleanError())}cleanError(){this.parent.classList.remove("warning"),this.error.style.display="none"}}const i={email:new e({id:"signup-email",name:"email",validation:/^[^\s@]+@[^\s@]+\.[^\s@]+$/}),password:new e({id:"signup-password",name:"password",validation:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*#?&])[a-zA-Z\d@$!%*#?&]{8,}$/}),checkbox:new class extends e{constructor({id:e="",name:t}){super({id:e,name:t}),this.parent=this.parent.parentElement,this.error=this.parent.querySelector(".alart-text"),this.element.addEventListener("input",()=>{this.handleInput()})}get isValid(){return this.element.checked}}({id:"checkedRequered4",name:"checkbox"})},r=(i.confirmPassword=new class extends e{constructor({id:e="",doc:t=document,name:n,elemId:s="signup-password"}){super({id:e,name:n}),this.elem2=t.querySelector("#"+s),this.element.addEventListener("focus",()=>this.cleanError())}get isValid(){return this.element.value===this.elem2.value}handleInput(){var e=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*#?&])[a-zA-Z\d@$!%*#?&]{8,}$/.test(this.elem2.value);this.element.value.length&&e&&super.handleInput()}}({id:"signup-confirm-password",name:"confirmPassword",elemId:"signup-password"}),Object.keys(i)),l=a.querySelector("#signup-submit");var o=!(l.onclick=function(e){e.preventDefault();let t=l.disabled=!0;if(!1===o){o=!0;for(var n of r)i[n].element.addEventListener("input",()=>{!0===l.disabled&&(l.disabled=!function(){var e=!0;for(var t of r)if(!1===i[t].isValid){e=!1;break}return e}())})}var s;for(s of Object.keys(i)){const r=i[s];r.handleInput(),1==t&&!1===r.isValid&&(t=!1)}!1!==t&&grecaptcha.execute()});window.handleSubmit=async function(n){let s=i.email.element.value;l.disabled=!0,l.innerHTML="Signing up";n=await async function(e){var t={message:"",errorMessage:null,status:null},e=await fetch("https://api.accbuddy.com/public",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signup:{token:e,user:{username:i.email.element.value,password:i.password.element.value}}})}),n=await e.json();if(e.ok||400!=e.status){if(e.ok){const e=n.result;t.message=e,a.reset()}}else{console.log("json response",n);const a=n.error;t.status=e.status,t.errorMessage=a}return console.log("normalized result",t),t}(n);l.innerHTML="Sign up";let e=document.querySelector("#plank-error-id"),t=a.querySelector(".ab-input-group-content-box"),r=a.querySelector(".ab-auth-content-wrap-box");if(null!==n.errorMessage)e.classList.remove("hidden"),e.querySelector("#plank-close").addEventListener("click",()=>{e.classList.add("hidden")}),l.disabled=!0;else{t.style.display="none",r.style.display="flex",a.querySelector("#user-email").innerText=s;const n=a.querySelector("#resend-email-btn");n.addEventListener("click",async()=>{const e=await async function(e){var t={message:"",errorMessage:null,status:null},e=await fetch("https://api.accbuddy.com/public",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resendConfirmation:{token:"",user:{username:e}}})}),n=await e.json();if(e.ok||400!=e.status){if(e.ok){const e=n.result;t.message=e,a.reset()}}else{console.log("json response",n);const a=n.error;t.status=e.status,t.errorMessage=a}return console.log("resend result",t),t}(s);if(null===e.errorMessage){a.querySelector("#sent-resent").innerText="re-sent";const e=a.querySelector("#resend-email-btn-inactive"),s=(n.style.display="none",e.style.display="block",a.querySelector("#resend-timer")),t=setInterval(()=>{s?(s.innerText=parseInt(s.innerText)-1,"0"===s.innerText&&(clearInterval(t),n.style.display="block",s.innerText="60",e.style.display="none")):console.log("resendTimer does not exist")},1e3);a.querySelector("#resend-ok").addEventListener("click",()=>{clearInterval(t),window.location.assign(window.location.href.replace("signup.html","index.html"))})}}),a.querySelector("#resend-ok").addEventListener("click",()=>{window.location.assign(window.location.href.replace("signup.html","index.html"))}),l.disabled=!1}grecaptcha.reset()},(t=document.createElement("div")).innerHTML="<div class='g-recaptcha' data-sitekey='6LcShYkmAAAAAA_FN5w0Oewh_-7XzIocjZlX6apw'data-callback='handleSubmit' data-size='invisible'></div>",t=t.firstElementChild,a.appendChild(t),(t=document.createElement("script")).src="https://www.google.com/recaptcha/api.js",t.async=!0,t.defer=!0,document.head.appendChild(t);{var t=document.querySelectorAll(".toggle-eye");let n=!1;t.forEach(e=>{const t=e.parentElement.parentElement.querySelector('input[type="password"]');e.addEventListener("click",()=>{n=!n,t.type=n?"text":"password"})})}});